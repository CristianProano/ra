<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realidad Aumentada</title>

    <!-- Librerías necesarias -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/dev/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.1.0/dist/aframe-extras.min.js"></script>
</head>
<body>
    <!-- Escena de Realidad Aumentada -->
    <a-scene embedded arjs="sourceType:webcam; debugUIEnabled: false;" id="scene">
        
        <!-- Almacenamos los assets del modelo 3D -->
        <a-assets>
            <a-asset-item id="dragon-obj" src="cyber-arm-painted/source/CYBER ARM_PAINTED_A.obj"></a-asset-item>
            <a-asset-item id="dragon-mtl" src="cyber-arm-painted/source/CYBER ARM_PAINTED_A.mtl"></a-asset-item>
        </a-assets>

        <!-- Definimos el marcador con el archivo .patt -->
        <a-marker type="pattern" url="pattern-marker.patt" 
                  id="markerCustom"
                  emitevents="true">
            
            <!-- Modelo 3D -->
            <a-entity id="dragon-model"
                      position="0 0 0" 
                      rotation="0 0 0" 
                      scale="0.2 0.2 0.2"
                      obj-model="obj: #dragon-obj; mtl: #dragon-mtl"
                      visible="false">
            </a-entity>
        </a-marker>

        <!-- Cámara -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Esperar a que la escena esté completamente cargada
        document.addEventListener("DOMContentLoaded", function () {
            console.log("Escena cargada...");

            // Obtener el marcador y el modelo 3D
            const marker = document.querySelector("#markerCustom");
            const model = document.querySelector("#dragon-model");

            if (!marker) {
                console.error("❌ ERROR: No se encontró el marcador. Verifica el ID y la configuración.");
                return;
            }

            if (!model) {
                console.error("❌ ERROR: No se encontró el modelo 3D. Verifica el ID y las rutas.");
                return;
            }

            // Evento cuando el marcador es detectado
            marker.addEventListener("markerFound", () => {
                console.log("✅ ¡Marcador personalizado detectado!");
                model.setAttribute("visible", "true"); // Muestra el modelo
            });

            // Evento cuando el marcador se pierde
            marker.addEventListener("markerLost", () => {
                console.log("🔴 Marcador perdido");
                model.setAttribute("visible", "false"); // Oculta el modelo
            });
        });
    </script>
</body>
</html>
